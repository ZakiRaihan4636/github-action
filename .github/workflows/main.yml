on:
  push:
    branches: [ main ]

name: ðŸš€ Deploy website on push

jobs:
  web-deploy:
    name: ðŸŽ‰ Auto Deploy
    runs-on: ubuntu-latest

    steps:
    - name: ðŸšš Get latest code
      uses: actions/checkout@v2.3.2

    - name: ðŸ“¦ Install sshpass
      run: sudo apt-get install -y sshpass

    - name: ðŸ”‘ Add server to known_hosts
      run: |
        mkdir -p ~/.ssh
        ssh-keyscan -p 2223 ${{ secrets.DEPLOY_HOST }} >> ~/.ssh/known_hosts
        chmod 644 ~/.ssh/known_hosts

    - name: ðŸ“‚ Sync files
      run: |
        sshpass -p "${{ secrets.DEPLOY_PASSWORD }}" rsync -avzr --delete --exclude=".git" --exclude=".github" ./ ${{ secrets.DEPLOY_USER }}@${{ secrets.DEPLOY_HOST }}:${{ secrets.DEPLOY_PATH }} -e "ssh -p 2223"
